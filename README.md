# 鱼BI项目后端笔记


## 模板特点

### 主流框架 & 特性

- Spring Boot 2.7.x（贼新）
- Spring MVC
- MyBatis + MyBatis Plus 数据访问（开启分页）
- Spring Boot 调试工具和项目处理器
- Spring AOP 切面编程
- Spring Scheduler 定时任务
- Spring 事务注解

### 数据存储

- MySQL 数据库



### 工具类

- Easy Excel 表格处理
- Hutool 工具库
- Gson 解析库
- Apache Commons Lang3 工具类
- Lombok 注解

### 业务特性

- 全局请求响应拦截器（记录日志）
- 全局异常处理器
- 自定义错误码
- 封装通用响应类
- Swagger + Knife4j 接口文档
- 自定义权限注解 + 全局校验
- 全局跨域处理
- 长整数丢失精度解决
- 多环境配置


## 业务功能
- 对用户数据的处理
- 通过AI自动对数据进行分析以及生成图表
- 能够对用户自我数据的管理

### 单元测试

- JUnit5 单元测试
- 示例单元测试类


### 项目存在的不足

#### 文件校验

- 对文件的大小进行校验
- 对文件的后缀名进行校验
- 对文件的内容进行校验（比较复杂，使用第三方库可以达成）


#### 对数据的存储处理
- 随着用户的增多 会产生很多的原始数据 为了方便对用户的数据进行查询和存储 我们采用分库分表的形式进行
- 将用户产生的原始数据单独生成一个表 即 chart_{chartId}
- 在 chartMapper.xml中动态写入sql语句
 ```xml
    <select id="queryChartData" parameterType="string" resultType="map">
        ${querySql}
    </select>
- ```
- 按照mybatis的方法继续写service层和controller层

#### 对AI接口的三种调用方式
- 使用openai官方接口 需要准备一个自己的权限 根据openai官方文档即可使用
- 使用本地的封装好的接口，收费可能会更高
- 使用鱼聪明ai接口只需要调用 详情请参考 **https://github.com/liyupi/yucongming-java-sdk** 文档
- 网站：https://www.yucongming.com/?current=1
- ![img.png](img.png) （开放平台中获取密钥）

#### 限流算法
>
> ##### 分库分表的原则：
>- 分库分表是数据库领域的一种设计方案，主要用于应对大型应用系统中数据量巨大、并发访问量高的情况。其核心思想是将数据分散到多个数据库（分库）和/或数据库中的多个表（分表）中，以达到以下几个目的：
   >   1. **水平扩展**：通过增加更多的数据库实例来分散压力，提高系统的并发处理能力。
>   2. **数据隔离**：不同类型的数据可以存储在不同的数据库中，实现业务隔离，降低业务间的相互影响。
>   3. **简化管理**：单个数据库的数据量减少，使得备份、恢复、维护等操作更加简单快速。
>   4. **提高性能**：查询、更新等操作可以分散到不同的数据库或表中，降低单点压力，提升整体性能。

> ### 常见分库分表策略：
>   1. **垂直分库**：按照业务的不同将不同的业务数据存储在不同的数据库中。
>   2. **水平分库**：根据一定的规则将数据分布到多个数据库中，如按照用户地区、用户类型等。
>   3. **垂直分表**：将一个表中的列拆分到不同的表中，通常是根据列的使用频率来拆分。
>   4. **水平分表**：将一个表中的行按照一定的规则拆分到多个表中，如根据ID的范围。

> ### 面临的挑战：
>   - **事务一致性**：分库分表后，跨库事务的管理变得复杂，需要额外的机制来保证ACID特性。
>   - **数据迁移**：随着业务的发展，原有的分库分表策略可能不再适用，需要进行数据的迁移，这通常是一个复杂和风险较高的操作。
>   - **跨库查询**：分库后，原本简单的跨表查询可能需要跨库操作，这需要额外的设计和支持。
>   - 分库分表是数据库架构设计中的重要部分，需要根据实际的业务需求和未来的扩展性来综合考虑。在设计分库分表方案时，也要考虑到数据一致性、查询性能、系统复杂性等多方面因素。




